<div id="results" aria-live="polite">
  <!-- Skeleton loader -->
  <template x-if="loading && results.length === 0">
    <div class="skeleton-loader">
      <template x-for="i in 3">
        <div class="skeleton-card">
          <div class="skeleton-header">
            <div class="skeleton-avatar"></div>
            <div class="skeleton-title"></div>
          </div>
          <div class="skeleton-body">
            <div class="skeleton-line"></div>
            <div class="skeleton-line short"></div>
          </div>
        </div>
      </template>
    </div>
  </template>

  <!-- Empty state -->
  <template x-if="!loading && results.length === 0 && searched && !error">
    <div class="empty-state">
      <div class="empty-icon">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
          <line x1="8" y1="8" x2="14" y2="14"></line>
          <line x1="14" y1="8" x2="8" y2="14"></line>
        </svg>
      </div>
      <p class="empty-message" id="no-results-i18n" data-i18n="no_results"></p>
      <p class="empty-suggestion">Try adjusting your search radius or fuel type</p>
    </div>
  </template>

  <!-- Results -->
  <template x-if="results.length > 0">
    <section class="results-layout" aria-labelledby="results-heading">
      <h2 id="results-heading" class="sr-only" data-i18n="results_heading"></h2>

      <!-- Station Cards List -->
      <div id="stations-list">
        <template x-for="(station, index) in results" :key="station.id || index">
          <article class="station-card" :class="{ 'best-price': isCheapestStation(index) }"
            @click="selectStationForMap(station.id)" @keyup.enter="selectStationForMap(station.id)" tabindex="0"
            :aria-label="(station.gestore || (typeof t !== 'undefined' ? t('station', 'Gas Station') : 'Gas Station')) + ', ' + formatCurrency(station.fuel_prices?.[0]?.price || 0)">
            <div class="station-card-header">
              <div class="station-brand">
                <div class="station-icon">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                    <path d="M2 17l10 5 10-5"></path>
                    <path d="M2 12l10 5 10-5"></path>
                  </svg>
                </div>
                <span x-text="station.gestore || translate('station', 'Gas Station')"></span>
              </div>
              <div class="station-price" aria-label="Price">
                <div class="flex items-center gap-2">
                  <template x-if="station.fuel_prices && station.fuel_prices.length > 0">
                    <span class="uppercase tracking-wide text-sm" :class="{
                      'text-yellow-600': station.fuel_prices[0].type === 'benzina',
                      'text-gray-600 dark:text-gray-400': station.fuel_prices[0].type === 'gasolio',
                      'text-blue-600': station.fuel_prices[0].type === 'GPL',
                      'text-green-600': station.fuel_prices[0].type === 'metano'
                    }" x-text="translateFuel(station.fuel_prices[0].type)"></span>
                  </template>
                  <template x-if="station.fuel_prices && station.fuel_prices.length > 0">
                    <span class="text-2xl font-bold text-primary" x-text="formatCurrency(station.fuel_prices[0].price)"></span>
                  </template>
                  <template x-if="isCheapestStation(index)">
                    <span class="text-xs font-bold text-primary uppercase tracking-wide" x-text="translate('best_price', 'Miglior Prezzo!')"></span>
                  </template>
                  <template x-if="station.fuel_prices && station.fuel_prices.length > 0 && !isCheapestStation(index)">
                    <span class="text-sm text-red-500 font-medium" x-text="getPriceDifference(index)"></span>
                  </template>
                  <template x-if="station.distance">
                    <span class="flex items-center gap-1 text-sm text-gray-500 dark:text-gray-400">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                      </svg>
                      <span x-text="formatDistance(station.distance)"></span>
                    </span>
                  </template>
                </div>
              </div>
            </div>

            <div class="station-card-body">
              <div class="station-address-row">
                <svg class="address-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                  stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <span class="station-address" x-text="station.address"></span>
              </div>

              <!-- Station Actions - Moved inside each card -->
              <div class="station-actions-row">
                <button class="btn btn-primary btn-sm" @click.stop="getDirections(station)"
                  :disabled="!station.latitude || !station.longitude"
                  :title="(!station.latitude || !station.longitude) ? translate('coords_missing', 'Directions unavailable: coordinates missing') : ''">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"></path>
                  </svg>
                  <span x-text="translate('navigate', 'Navigate') + (currentLang ? '' : '')"></span>
                </button>
                <button class="btn btn-secondary btn-sm" @click.stop="selectStationForMap(station.id)"
                  :disabled="!station.latitude || !station.longitude"
                  :title="(!station.latitude || !station.longitude) ? translate('coords_missing', 'Map unavailable: coordinates missing') : ''">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  <span x-text="translate('show_on_map', 'Show on Map') + (currentLang ? '' : '')"></span>
                </button>
              </div>
            </div>
          </article>
        </template>
      </div>
    </section>
  </template>

  <!-- Error Message -->
  <template x-if="error">
    <div class="error-message" role="alert">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        class="error-icon">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <span x-text="error"></span>
    </div>
  </template>
</div>