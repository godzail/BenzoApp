<div id="results" aria-live="polite">
  <!-- Skeleton loader -->
  <template x-if="loading && results.length === 0">
    <div class="skeleton-loader flex flex-col gap-4">
      <template x-for="i in 3">
        <div class="skeleton-card bg-[var(--bg-surface)] border border-[var(--border-color)] rounded-xl p-6">
          <div class="skeleton-header flex items-center gap-4 mb-4">
            <div class="skeleton-avatar w-10 h-10 rounded-lg animate-shimmer"></div>
            <div class="skeleton-title flex-1 h-4 rounded animate-shimmer"></div>
          </div>
          <div class="skeleton-body">
            <div class="h-3 rounded animate-shimmer mb-2"></div>
            <div class="h-3 rounded animate-shimmer w-3/5"></div>
          </div>
        </div>
      </template>
    </div>
  </template>

  <!-- Empty state -->
  <template x-if="!loading && results.length === 0 && searched && !error">
    <div class="empty-state text-center p-8 bg-[var(--bg-surface)] border border-[var(--border-color)] rounded-xl">
      <div class="empty-icon text-6xl text-[var(--border-color)] mb-6">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
          <line x1="8" y1="8" x2="14" y2="14"></line>
          <line x1="14" y1="8" x2="8" y2="14"></line>
        </svg>
      </div>
      <p class="empty-message text-lg text-[var(--text-primary)] mb-2" id="no-results-i18n" data-i18n="no_results"></p>
      <p class="empty-suggestion text-base text-[var(--text-muted)]">Try adjusting your search radius or fuel type</p>
    </div>
  </template>

  <!-- Results -->
  <template x-if="results.length > 0">
    <section class="results-layout" aria-labelledby="results-heading">
      <h2 id="results-heading" class="sr-only" data-i18n="results_heading"></h2>

      <!-- Station Cards List -->
      <div id="stations-list">
        <template x-for="(station, index) in results" :key="station.id || index">
          <article class="station-card bg-[var(--bg-surface)] border border-[var(--border-color)] rounded-xl p-6 shadow-md transition-all duration-150 cursor-pointer relative min-h-[180px] hover:translate-y-[-2px] hover:shadow-xl hover:border-[var(--color-primary)]" :class="{ 'border-2 border-[var(--color-primary)] shadow-[0_0_20px_rgba(0,200,83,0.2)]': isCheapestStation(index) }"
            @click="selectStationForMap(station.id)" @keyup.enter="selectStationForMap(station.id)" tabindex="0"
            :aria-label="(station.gestore || (typeof t !== 'undefined' ? t('station', 'Gas Station') : 'Gas Station')) + ', ' + formatCurrency(station.fuel_prices?.[0]?.price || 0)">
            <!-- Best Price Badge -->
            <template x-if="isCheapestStation(index)">
              <span class="inline-block bg-[var(--color-primary)] text-[#002c18] px-2 py-0.5 rounded-full text-xs font-bold uppercase tracking-wide animate-pulse-badge mb-1 whitespace-nowrap" x-text="translate('best_price', 'Miglior Prezzo!')"></span>
            </template>

            <div class="station-card-header flex justify-between items-start mb-4 gap-4 min-w-0">
              <div class="station-brand flex items-center gap-2 text-lg font-semibold text-[var(--text-primary)] min-w-0 flex-1">
                <div class="station-icon w-8 h-8 bg-[var(--color-primary-light)] rounded-lg flex items-center justify-center text-[var(--color-primary-dark)]">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                    <path d="M2 17l10 5 10-5"></path>
                    <path d="M2 12l10 5 10-5"></path>
                  </svg>
                </div>
                <span class="truncate overflow-hidden text-ellipsis whitespace-nowrap" x-text="station.gestore || translate('station', 'Gas Station')"></span>
              </div>
              <div class="station-price flex flex-row items-center gap-2 flex-wrap justify-end flex-shrink-0">
                <template x-if="station.fuel_prices && station.fuel_prices.length > 0">
                  <span class="uppercase tracking-wide text-sm" :class="{
                      'text-[var(--fuel-benzina-color)]': station.fuel_prices[0].type === 'benzina',
                      'text-[var(--fuel-gasolio-color)]': station.fuel_prices[0].type === 'gasolio',
                      'text-[var(--fuel-gpl-color)]': station.fuel_prices[0].type === 'GPL',
                      'text-[var(--fuel-metano-color)]': station.fuel_prices[0].type === 'metano'
                    }" x-text="translateFuel(station.fuel_prices[0].type)"></span>
                </template>
                <template x-if="station.fuel_prices && station.fuel_prices.length > 0">
                  <span class="text-2xl font-bold text-[var(--color-primary)]" x-text="formatCurrency(station.fuel_prices[0].price)"></span>
                </template>
                <template x-if="station.fuel_prices && station.fuel_prices.length > 0 && !isCheapestStation(index)">
                  <span class="text-sm text-red-500 font-medium" x-text="getPriceDifference(index)"></span>
                </template>
                <template x-if="station.distance">
                  <span class="flex items-center gap-1 text-sm text-[var(--text-muted)]">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span x-text="formatDistance(station.distance)"></span>
                  </span>
                </template>
              </div>
            </div>

            <div class="station-card-body flex flex-col gap-2">
              <div class="station-address-row flex items-start gap-2 text-sm text-[var(--text-secondary)] break-word overflow-wrap-break-word">
                <svg class="address-icon w-4 h-4 text-[var(--text-muted)] mt-0.5" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <span class="break-word overflow-wrap-break-word leading-relaxed max-w-full" x-text="station.address"></span>
              </div>

              <!-- Station Actions - Moved inside each card -->
              <div class="station-actions-row flex gap-2 mt-4 pt-4 border-t border-[var(--border-color)]">
                <button class="btn btn-primary flex-1 min-w-0 whitespace-nowrap bg-[var(--color-primary)] text-white border-none rounded-lg py-2 px-3 text-sm font-semibold cursor-pointer transition-all duration-150 inline-flex items-center justify-center hover:bg-[var(--color-primary-hover)] hover:-translate-y-0.5 hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed disabled:grayscale disabled:transform-none" @click.stop="getDirections(station)"
                  :disabled="!station.latitude || !station.longitude"
                  :title="(!station.latitude || !station.longitude) ? translate('coords_missing', 'Directions unavailable: coordinates missing') : ''">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"></path>
                  </svg>
                  <span x-text="translate('navigate', 'Navigate') + (currentLang ? '' : '')"></span>
                </button>
                <button class="btn btn-secondary flex-1 min-w-0 whitespace-nowrap bg-[var(--bg-elevated)] text-[var(--text-primary)] border border-[var(--border-color)] rounded-lg py-2 px-3 text-sm font-semibold cursor-pointer transition-all duration-150 inline-flex items-center justify-center hover:bg-[var(--bg-surface)] hover:border-[var(--color-primary)] hover:text-[var(--color-primary)] disabled:opacity-50 disabled:cursor-not-allowed" @click.stop="selectStationForMap(station.id)"
                  :disabled="!station.latitude || !station.longitude"
                  :title="(!station.latitude || !station.longitude) ? translate('coords_missing', 'Map unavailable: coordinates missing') : ''">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  <span x-text="translate('show_on_map', 'Show on Map') + (currentLang ? '' : '')"></span>
                </button>
              </div>
            </div>
          </article>
        </template>
      </div>
    </section>
  </template>

  <!-- Error Message -->
  <template x-if="error">
    <div class="error-message flex items-center bg-red-500/10 text-red-500 p-4 rounded-xl border border-red-500/20 mt-4 font-medium" role="alert">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mr-2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <span x-text="error"></span>
    </div>
  </template>
</div>
