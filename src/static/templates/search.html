<!-- Recent Searches -->
<template x-if="recentSearches.length > 0">
  <section class="recent-searches-container" aria-labelledby="recent-searches-i18n">
    <h3 class="recent-searches-title" id="recent-searches-i18n"></h3>
    <div class="recent-searches-list">
      <template x-for="(search, idx) in recentSearches" :key="idx">
        <button class="recent-search-btn" type="button" @click="selectRecentSearch(search)">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <span
            x-text="search.city + ', ' + search.radius + 'km, ' + (window.translateFuel ? translateFuel(search.fuel) : search.fuel)"></span>
        </button>
      </template>
    </div>
  </section>
</template>

<!-- Fuel Type Chips -->
<div class="fuel-chips" role="group" aria-label="Seleziona tipo di carburante">
  <button class="chip benzina" type="button" :class="{ 'active': isFuelSelected('benzina') }"
    :aria-pressed="isFuelSelected('benzina')" @click="setFuelType('benzina')">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
      <path d="M2 17l10 5 10-5"></path>
      <path d="M2 12l10 5 10-5"></path>
    </svg>
    <span x-text="translate('benzina', 'Benzina') + (currentLang ? '' : '')"></span>
  </button>
  <button class="chip gasolio" type="button" :class="{ 'active': isFuelSelected('gasolio') }"
    :aria-pressed="isFuelSelected('gasolio')" @click="setFuelType('gasolio')">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
      <path d="M2 17l10 5 10-5"></path>
      <path d="M2 12l10 5 10-5"></path>
    </svg>
    <span x-text="translate('diesel', 'Gasolio') + (currentLang ? '' : '')"></span>
  </button>
  <button class="chip GPL" type="button" :class="{ 'active': isFuelSelected('GPL') }"
    :aria-pressed="isFuelSelected('GPL')" @click="setFuelType('GPL')">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <path d="M12 6v6l4 2"></path>
    </svg>
    <span x-text="translate('gpl', 'GPL') + (currentLang ? '' : '')"></span>
  </button>
  <button class="chip metano" type="button" :class="{ 'active': isFuelSelected('metano') }"
    :aria-pressed="isFuelSelected('metano')" @click="setFuelType('metano')">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <path d="M12 6v6l4 2"></path>
    </svg>
    <span x-text="translate('metano', 'Metano') + (currentLang ? '' : '')"></span>
  </button>
</div>

<!-- Search Controls -->
<form id="search-form" @submit.prevent="submitForm" aria-labelledby="search-form-title">
  <h2 id="search-form-title" class="sr-only" data-i18n="search_form_title">Search for gas stations</h2>

  <!-- Hidden inputs for form data -->
  <input type="hidden" name="radius" x-model="formData.radius">
  <input type="hidden" name="fuel" x-model="formData.fuel">
  <!-- Search Settings Controls -->
  <div class="search-settings-grid">
    <!-- Radius Slider -->
    <div class="radius-control">
      <span x-text="translate('search_radius', 'Raggio di Ricerca') + (currentLang ? '' : '')"></span>
      <input type="range" class="radius-slider" min="1" max="50" step="1" x-model="formData.radius"
        aria-label="Raggio di ricerca">
      <span class="radius-value"> <span x-text="formData.radius"></span>km </span>
    </div>

    <!-- Max Results Slider -->
    <div class="radius-control">
      <span x-text="translate('max_results', 'Limite Risultati') + (currentLang ? '' : '')"></span>
      <input type="range" class="radius-slider" min="1" max="20" step="1" x-model="formData.results"
        aria-label="Limite risultati">
      <span class="radius-value"> <span x-text="formData.results"></span> </span>
    </div>
  </div>

  <!-- Submit Button -->
  <button class="btn btn-primary btn-block" :class="{ 'is-loading': loading }" type="submit"
    :disabled="loading || !formData.city">
    <span x-show="!loading" x-text="translate('search', 'Cerca') + (currentLang ? '' : '')"></span>
    <span x-show="loading">
      <svg class="spinner" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2">
        <path d="M21 12a9 9 0 1 1-6.219-8.56" stroke-linecap="round"></path>
      </svg>
      <span x-text="translate('loading', 'Caricamento...') + (currentLang ? '' : '')"></span>
    </span>
  </button>
</form>

<!-- Map Card - Moved from results to search column -->
<template x-if="results.length > 0">
  <details class="map-card search-column-map" open
    @toggle="$nextTick(() => { if (map && $event.target.open) { map.invalidateSize(); } })">
    <summary>
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
        <circle cx="12" cy="10" r="3"></circle>
      </svg>
      <span x-text="translate('map_summary', 'Mappa') + (currentLang ? '' : '')"></span>
    </summary>
    <div class="map-view">
      <div id="map"></div>
    </div>
  </details>
</template>